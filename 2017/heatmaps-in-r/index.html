<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <script type="application/ld+json">

{  
  "@context":"http://schema.org",
  "@type":"Website",
  "@id":"https:\/\/nitinahuja.github.io\/",
  "author": {
    "@type": "Person",
    "name": "Nitin Ahuja",
    
    "image": "https://www.gravatar.com/avatar/2a9756e94950a1dabeb63034558f787d"
    
  },
  "name":"A programmer\u0027s viewpoint",
  "description":"Heatmaps Heat maps are invaluable in displaying a large amount of continuous data contained in a 2d matrix. This post is meant to show a way to create a print worthy heat map in R.\nLet’s start by loading the required packages.\nsuppressPackageStartupMessages({ library(ggplot2) library(ggthemes) library(viridis) library(scales) library(tidyr) }) Data Our data is from a business that receives sales calls 24x7. Let’s read and see what the data looks like.",
  "url":"https:\/\/nitinahuja.github.io\/2017\/heatmaps-in-r\/",
  "keywords":"[]"
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.98.0 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="Nitin Ahuja">
<meta name="keywords" content="">
<meta name="description" content="Heatmaps Heat maps are invaluable in displaying a large amount of continuous data contained in a 2d matrix. This post is meant to show a way to create a print worthy heat map in R.
Let’s start by loading the required packages.
suppressPackageStartupMessages({ library(ggplot2) library(ggthemes) library(viridis) library(scales) library(tidyr) }) Data Our data is from a business that receives sales calls 24x7. Let’s read and see what the data looks like.">


<meta property="og:description" content="Heatmaps Heat maps are invaluable in displaying a large amount of continuous data contained in a 2d matrix. This post is meant to show a way to create a print worthy heat map in R.
Let’s start by loading the required packages.
suppressPackageStartupMessages({ library(ggplot2) library(ggthemes) library(viridis) library(scales) library(tidyr) }) Data Our data is from a business that receives sales calls 24x7. Let’s read and see what the data looks like.">
<meta property="og:type" content="article">
<meta property="og:title" content="Heat maps in R">
<meta name="twitter:title" content="Heat maps in R">
<meta property="og:url" content="https://nitinahuja.github.io/2017/heatmaps-in-r/">
<meta property="twitter:url" content="https://nitinahuja.github.io/2017/heatmaps-in-r/">
<meta property="og:site_name" content="A programmer&#39;s viewpoint">
<meta property="og:description" content="Heatmaps Heat maps are invaluable in displaying a large amount of continuous data contained in a 2d matrix. This post is meant to show a way to create a print worthy heat map in R.
Let’s start by loading the required packages.
suppressPackageStartupMessages({ library(ggplot2) library(ggthemes) library(viridis) library(scales) library(tidyr) }) Data Our data is from a business that receives sales calls 24x7. Let’s read and see what the data looks like.">
<meta name="twitter:description" content="Heatmaps Heat maps are invaluable in displaying a large amount of continuous data contained in a 2d matrix. This post is meant to show a way to create a print worthy heat map in R.
Let’s start by loading the required packages.
suppressPackageStartupMessages({ library(ggplot2) library(ggthemes) library(viridis) library(scales) library(tidyr) }) Data Our data is from a business that receives sales calls 24x7. Let’s read and see what the data looks like.">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2017-09-11T00:00:00">
  
  
    <meta property="article:modified_time" content="2017-09-11T00:00:00">
  
  
  
    
      <meta property="article:section" content="R">
    
  
  
    
      <meta property="article:tag" content="learning">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@nitinahuja">


  <meta name="twitter:creator" content="@nitinahuja">






  <meta property="og:image" content="https://www.gravatar.com/avatar/2a9756e94950a1dabeb63034558f787d?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/2a9756e94950a1dabeb63034558f787d?s=640">




  <meta property="og:image" content="https://nitinahuja.github.io/img/heat.jpg">
  <meta property="twitter:image" content="https://nitinahuja.github.io/img/heat.jpg">


  <meta property="og:image" content="https://nitinahuja.github.io/img/heat_thumb.jpg">
  <meta property="twitter:image" content="https://nitinahuja.github.io/img/heat_thumb.jpg">


    <title>Heat maps in R</title>

    <link rel="icon" href="https://nitinahuja.github.io/favicon.png">
    

    

    <link rel="canonical" href="https://nitinahuja.github.io/2017/heatmaps-in-r/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://nitinahuja.github.io/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-105634890-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
    
    
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
      <link rel="stylesheet" href="https://nitinahuja.github.io/css/codefolding.css" />
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://nitinahuja.github.io/" aria-label="Go to homepage">A programmer&#39;s viewpoint</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://nitinahuja.github.io/#about" aria-label="Open the link: /#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/2a9756e94950a1dabeb63034558f787d?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://nitinahuja.github.io/#about" aria-label="Read more about the author">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/2a9756e94950a1dabeb63034558f787d?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Nitin Ahuja</h4>
        
          <h5 class="sidebar-profile-bio">A programmer&rsquo;s viewpoint</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nitinahuja.github.io/" title="Home">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nitinahuja.github.io/categories" title="Categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nitinahuja.github.io/tags" title="Tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nitinahuja.github.io/archives" title="Archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nitinahuja.github.io/#about" title="About">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/nitinahuja" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nitinahuja.github.io/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-left
              "
       style="background-image:url('/img/heat.jpg')"
       data-behavior="4">
    
      <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      Heat maps in R
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2017-09-11T00:00:00Z">
        
  September 11, 2017

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://nitinahuja.github.io/categories/r">R</a>
    
  

  </div>

  

<div id="code-folding-buttons" class="dropdown btn-group pull-right">
  <a class="btn btn-light btn-sm dropdown-toggle" href="#" role="button" id="allCodeToggleButton"
     data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Code
  </a>
  <div class="dropdown-menu" aria-labelledby="allCodeToggleButton">
    <a id="rmd-show-all-code" class="dropdown-item small" href="#">Show all</a>
    <a id="rmd-hide-all-code" class="dropdown-item small" href="#">Hide all</a>
  </div>
</div>


</div>
    
  </div>


      <div id="main" data-behavior="4"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" id="top">
          
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              


<div id="heatmaps" class="section level2">
<h2>Heatmaps</h2>
<p>Heat maps are invaluable in displaying a large amount of continuous data contained in a 2d matrix. This post is meant to show a way to create a print worthy heat map in R.</p>
<p>Let’s start by loading the required packages.</p>
<pre class="r"><code>suppressPackageStartupMessages({
  library(ggplot2)
  library(ggthemes)
  library(viridis)
  library(scales)
  library(tidyr)
})</code></pre>
<div id="data" class="section level3">
<h3>Data</h3>
<p>Our data is from a business that receives sales calls 24x7. Let’s read and see what the data looks like. We have observations (count of calls) for each day of the week and each hour of the day.
If there is missing data, we can use the handy <code>complete()</code> function from the tidy universe to fill in values. Leaving the NA values creates an ugly column in the final heat map.</p>
<pre class="r"><code>vendor &lt;- &quot;Tours 6/1/15 - 5/30/17&quot;
calls &lt;- read.csv(&#39;~/data/calls.csv&#39;, header = TRUE)
calls &lt;- complete(calls, day, call_hour,  fill = list(call = 0))
str(calls)</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    168 obs. of  3 variables:
##  $ day      : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ call_hour: int  0 1 2 3 4 5 6 7 8 9 ...
##  $ call     : num  300 98 74 99 340 45 91 1500 604 531 ...</code></pre>
<p>We can see that the day of the week is an integer and we will convert those to a factor with the day names as levels.</p>
<p>Similarly, we will covert the hour of the day to a factor representation. We are only interested in business hours and this will also reorder the labels to start from 6 AM.</p>
<pre class="r"><code>calls$day &lt;- factor(calls$day, ordered=TRUE, labels=c(&quot;Sunday&quot;, &quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot;, &quot;Thursday&quot;, &quot;Friday&quot;, &quot;Saturday&quot;))
calls$hr &lt;- factor(format(as.POSIXct(as.character(calls$call_hour), format = &quot;%H&quot;), &#39;%I %p&#39;) , levels = c(&quot;06 AM&quot;, &quot;07 AM&quot;, &quot;08 AM&quot;, &quot;09 AM&quot;, &quot;10 AM&quot;, &quot;11 AM&quot;, &quot;12 PM&quot;, &quot;01 PM&quot;, &quot;02 PM&quot;, &quot;03 PM&quot;, &quot;04 PM&quot;, &quot;05 PM&quot;, &quot;06 PM&quot;, &quot;07 PM&quot;, &quot;08 PM&quot;, &quot;09 PM&quot;, &quot;10 PM&quot;, &quot;11 PM&quot;, &quot;12 AM&quot;))
str(calls)</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    168 obs. of  4 variables:
##  $ day      : Ord.factor w/ 7 levels &quot;Sunday&quot;&lt;&quot;Monday&quot;&lt;..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ call_hour: int  0 1 2 3 4 5 6 7 8 9 ...
##  $ call     : num  300 98 74 99 340 45 91 1500 604 531 ...
##  $ hr       : Factor w/ 19 levels &quot;06 AM&quot;,&quot;07 AM&quot;,..: 19 NA NA NA NA NA 1 2 3 4 ...</code></pre>
<p>Finally, we will use the <strong><a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">viridis</a></strong> color palette to make this easier to interpret. The <strong>theme_tufte</strong> removes the border, axis and girds to make this look a lot cleaner, and I do like the <strong>plasma</strong> palette.</p>
<p>It’s clear from this heat map that Monday, Tuesday and Wednesday mornings are peak times for calls and therefore staffing can be adjusted based on these numbers.</p>
<p>To make it higher resolution for printing, use the <strong>ggsave()</strong> method.</p>
<pre class="r"><code>  calls_business &lt;- calls %&gt;% 
  dplyr::filter(call_hour &gt; 4, call_hour &lt; 21) %&gt;% 
  dplyr::filter(!is.na(hr))

  gg &lt;- ggplot(calls_business , aes(x=hr, y=day, fill = call)) + 
    geom_tile(color = &quot;white&quot;, size = 0.1) + 
    scale_x_discrete(expand=c(0,0)) + 
    scale_y_discrete(expand=c(0,0)) + 
    scale_fill_viridis(name=&quot;# of calls&quot;, option = &quot;plasma&quot;) + 
    coord_equal() + 
    labs(x=&quot;Call hour&quot;, y=NULL, title=sprintf(&quot;Calls per hour of day - %s&quot;, vendor)) + 
    theme_tufte(base_family=&quot;Helvetica&quot;) +
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
  
  gg</code></pre>
<p><img src="https://nitinahuja.github.io/post/2017-09-11-heatmaps-in-r_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
</div>

              


            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://nitinahuja.github.io/tags/learning/">learning</a>

                  </div>
                
              
            
            
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://nitinahuja.github.io/2017/nps-exploratory-text-analysis/" data-tooltip="NPS - Exploratory analysis in R - Text analysis" aria-label="NEXT: NPS - Exploratory analysis in R - Text analysis">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://nitinahuja.github.io/2017/managing-managers-some-thoughts/" data-tooltip="Managing managers - some thoughts" aria-label="PREVIOUS: Managing managers - some thoughts">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
  
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


            
  


          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 Nitin Ahuja. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://nitinahuja.github.io/2017/nps-exploratory-text-analysis/" data-tooltip="NPS - Exploratory analysis in R - Text analysis" aria-label="NEXT: NPS - Exploratory analysis in R - Text analysis">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://nitinahuja.github.io/2017/managing-managers-some-thoughts/" data-tooltip="Managing managers - some thoughts" aria-label="PREVIOUS: Managing managers - some thoughts">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
  
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


      </div>
      

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/2a9756e94950a1dabeb63034558f787d?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Nitin Ahuja</h4>
    
      <div id="about-card-bio">A programmer&rsquo;s viewpoint</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Forever learning
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        California
      </div>
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('https://nitinahuja.github.io/images/cover.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>



<script src="https://nitinahuja.github.io/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>






     
  <script>
  $(document).ready(function () {
    window.initializeCodeFolding("show" === "hide");
  });
  </script>
  <script src="https://nitinahuja.github.io/js/codefolding.js"></script>

    
  </body>
</html>

